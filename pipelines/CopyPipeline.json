{"$schema":"http://schema.management.azure.com/schemas/2015-01-01/deploymentTemplate.json#","contentVersion":"1.0.0.0","parameters":{"workspaceName":{"type":"string","metadata":"Workspace name","defaultValue":"synapsengvmskb"},"hathaiadlsgen2":{"type":"string"},"AzureSqlDatabase":{"type":"string"}},"variables":{"workspaceId":"[concat('Microsoft.Synapse/workspaces/', parameters('workspaceName'))]"},"resources":[{"name":"[concat(parameters('workspaceName'), '/CopyPipeline')]","type":"Microsoft.Synapse/workspaces/pipelines","apiVersion":"2019-06-01-preview","properties":{"activities":[{"name":"CopyFromBlobToSql","description":"copy a .csv file in adls2 and populate to a table in Azure SQL database","type":"Copy","state":"Inactive","onInactiveMarkAs":"Succeeded","dependsOn":[],"policy":{"timeout":"0.12:00:00","retry":0,"retryIntervalInSeconds":30,"secureOutput":false,"secureInput":false},"userProperties":[],"typeProperties":{"source":{"type":"DelimitedTextSource","storeSettings":{"type":"AzureBlobFSReadSettings","recursive":true,"enablePartitionDiscovery":false},"formatSettings":{"type":"DelimitedTextReadSettings"}},"sink":{"type":"AzureSqlSink","writeBehavior":"insert","sqlWriterUseTableLock":false},"enableStaging":false,"translator":{"type":"TabularTranslator","mappings":[{"source":{"name":"ItinID","type":"String"},"sink":{"name":"ItinID","type":"varchar"}},{"source":{"name":"Coupons","type":"String"},"sink":{"name":"Coupons","type":"int","precision":10}},{"source":{"name":"Year","type":"String"},"sink":{"name":"Year","type":"varchar"}},{"source":{"name":"Quarter","type":"String"},"sink":{"name":"Quarter","type":"int","precision":10}},{"source":{"name":"Origin","type":"String"},"sink":{"name":"Origin","type":"varchar"}},{"source":{"name":"OriginAirportID","type":"String"},"sink":{"name":"OriginAirportID","type":"int","precision":10}},{"source":{"name":"OriginAirportSeqID","type":"String"},"sink":{"name":"OriginAirportSeqID","type":"int","precision":10}},{"source":{"name":"OriginCityMarketID","type":"String"},"sink":{"name":"OriginCityMarketID","type":"int","precision":10}},{"source":{"name":"OriginCountry","type":"String"},"sink":{"name":"OriginCountry","type":"varchar"}},{"source":{"name":"OriginStateFips","type":"String"},"sink":{"name":"OriginStateFips","type":"int","precision":10}},{"source":{"name":"OriginState","type":"String"},"sink":{"name":"OriginState","type":"varchar"}},{"source":{"name":"OriginStateName","type":"String"},"sink":{"name":"OriginStateName","type":"varchar"}},{"source":{"name":"OriginWac","type":"String"},"sink":{"name":"OriginWac","type":"int","precision":10}},{"source":{"name":"RoundTrip","type":"String"},"sink":{"name":"RoundTrip","type":"decimal","scale":2,"precision":18}},{"source":{"name":"OnLine","type":"String"},"sink":{"name":"OnLine","type":"decimal","scale":2,"precision":18}},{"source":{"name":"DollarCred","type":"String"},"sink":{"name":"DollarCred","type":"bit"}},{"source":{"name":"FarePerMile","type":"String"},"sink":{"name":"FarePerMile","type":"decimal","scale":4,"precision":18}},{"source":{"name":"RPCarrier","type":"String"},"sink":{"name":"RPCarrier","type":"varchar"}},{"source":{"name":"Passengers","type":"String"},"sink":{"name":"Passengers","type":"decimal","scale":2,"precision":18}},{"source":{"name":"ItinFare","type":"String"},"sink":{"name":"ItinFare","type":"decimal","scale":2,"precision":18}},{"source":{"name":"BulkFare","type":"String"},"sink":{"name":"BulkFare","type":"decimal","scale":2,"precision":18}},{"source":{"name":"Distance","type":"String"},"sink":{"name":"Distance","type":"decimal","scale":2,"precision":18}},{"source":{"name":"DistanceGroup","type":"String"},"sink":{"name":"DistanceGroup","type":"int","precision":10}},{"source":{"name":"MilesFlown","type":"String"},"sink":{"name":"MilesFlown","type":"decimal","scale":2,"precision":18}},{"source":{"name":"ItinGeoType","type":"String"},"sink":{"name":"ItinGeoType","type":"int","precision":10}}],"typeConversion":true,"typeConversionSettings":{"allowDataTruncation":true,"treatBooleanAsNumber":false}}},"inputs":[{"referenceName":"SourceBlobAirlineTicketDataset","type":"DatasetReference","parameters":{}}],"outputs":[{"referenceName":"SinkSqlAirlineTicketDataset","type":"DatasetReference","parameters":{}}]},{"name":"CopyBlobToSQL","description":"ingest .csv file from adls gen2","type":"ExecuteDataFlow","dependsOn":[],"policy":{"timeout":"0.12:00:00","retry":0,"retryIntervalInSeconds":30,"secureOutput":false,"secureInput":false},"userProperties":[],"typeProperties":{"dataflow":{"referenceName":"CopyBlobToSQL","type":"DataFlowReference","parameters":{},"datasetParameters":{"SourceBlobRawDataset":{},"SinkTabularDataset":{}}},"staging":{},"compute":{"coreCount":8,"computeType":"General"},"traceLevel":"Fine"}}],"policy":{"elapsedTimeMetric":{}},"annotations":[],"lastPublishTime":"2024-05-19T00:54:53Z"},"dependsOn":["[concat(variables('workspaceId'), '/datasets/SourceBlobAirlineTicketDataset')]","[concat(variables('workspaceId'), '/datasets/SinkSqlAirlineTicketDataset')]","[concat(variables('workspaceId'), '/dataflows/CopyBlobToSQL')]"]},{"name":"[concat(parameters('workspaceName'), '/SourceBlobAirlineTicketDataset')]","type":"Microsoft.Synapse/workspaces/datasets","apiVersion":"2019-06-01-preview","properties":{"linkedServiceName":{"referenceName":"[parameters('hathaiadlsgen2')]","type":"LinkedServiceReference"},"annotations":[],"type":"DelimitedText","typeProperties":{"location":{"type":"AzureBlobFSLocation","fileName":"DB1BTicket_2023_1.csv","fileSystem":"airline-travel"},"columnDelimiter":",","escapeChar":"\\","firstRowAsHeader":true,"quoteChar":"\""},"schema":[{"name":"ItinID","type":"String"},{"name":"Coupons","type":"String"},{"name":"Year","type":"String"},{"name":"Quarter","type":"String"},{"name":"Origin","type":"String"},{"name":"OriginAirportID","type":"String"},{"name":"OriginAirportSeqID","type":"String"},{"name":"OriginCityMarketID","type":"String"},{"name":"OriginCountry","type":"String"},{"name":"OriginStateFips","type":"String"},{"name":"OriginState","type":"String"},{"name":"OriginStateName","type":"String"},{"name":"OriginWac","type":"String"},{"name":"RoundTrip","type":"String"},{"name":"OnLine","type":"String"},{"name":"DollarCred","type":"String"},{"name":"FarePerMile","type":"String"},{"name":"RPCarrier","type":"String"},{"name":"Passengers","type":"String"},{"name":"ItinFare","type":"String"},{"name":"BulkFare","type":"String"},{"name":"Distance","type":"String"},{"name":"DistanceGroup","type":"String"},{"name":"MilesFlown","type":"String"},{"name":"ItinGeoType","type":"String"}]},"dependsOn":[]},{"name":"[concat(parameters('workspaceName'), '/SinkSqlAirlineTicketDataset')]","type":"Microsoft.Synapse/workspaces/datasets","apiVersion":"2019-06-01-preview","properties":{"linkedServiceName":{"referenceName":"[parameters('AzureSqlDatabase')]","type":"LinkedServiceReference"},"annotations":[],"type":"AzureSqlTable","schema":[{"name":"ID","type":"int","precision":10},{"name":"ItinID","type":"varchar"},{"name":"Coupons","type":"int","precision":10},{"name":"Year","type":"varchar"},{"name":"Quarter","type":"int","precision":10},{"name":"Origin","type":"varchar"},{"name":"OriginAirportID","type":"int","precision":10},{"name":"OriginAirportSeqID","type":"int","precision":10},{"name":"OriginCityMarketID","type":"int","precision":10},{"name":"OriginCountry","type":"varchar"},{"name":"OriginStateFips","type":"int","precision":10},{"name":"OriginState","type":"varchar"},{"name":"OriginStateName","type":"varchar"},{"name":"OriginWac","type":"int","precision":10},{"name":"RoundTrip","type":"decimal","precision":18,"scale":2},{"name":"OnLine","type":"decimal","precision":18,"scale":2},{"name":"DollarCred","type":"bit"},{"name":"FarePerMile","type":"decimal","precision":18,"scale":4},{"name":"RPCarrier","type":"varchar"},{"name":"Passengers","type":"decimal","precision":18,"scale":2},{"name":"ItinFare","type":"decimal","precision":18,"scale":2},{"name":"BulkFare","type":"decimal","precision":18,"scale":2},{"name":"Distance","type":"decimal","precision":18,"scale":2},{"name":"DistanceGroup","type":"int","precision":10},{"name":"MilesFlown","type":"decimal","precision":18,"scale":2},{"name":"ItinGeoType","type":"int","precision":10}],"typeProperties":{"schema":"dbo","table":"airline_ticket"}},"dependsOn":[]},{"name":"[concat(parameters('workspaceName'), '/CopyBlobToSQL')]","type":"Microsoft.Synapse/workspaces/dataflows","apiVersion":"2019-06-01-preview","properties":{"type":"MappingDataFlow","typeProperties":{"sources":[{"dataset":{"referenceName":"SourceBlobAirlineTicketDataset","type":"DatasetReference"},"name":"SourceBlobRawDataset","description":"raw data from an .csv file in adls2"}],"sinks":[{"dataset":{"referenceName":"SinkSqlAirlineTicketDataset","type":"DatasetReference"},"name":"SinkTabularDataset","description":"sink to a table in Azure SQL Database"}],"transformations":[],"scriptLines":["source(output(","          ItinID as string,","          Coupons as integer,","          Year as string,","          Quarter as integer,","          Origin as string,","          OriginAirportID as integer,","          OriginAirportSeqID as integer,","          OriginCityMarketID as integer,","          OriginCountry as string,","          OriginStateFips as integer,","          OriginState as string,","          OriginStateName as string,","          OriginWac as integer,","          RoundTrip as decimal(10,0) '000,000,000.000',","          OnLine as decimal(10,0) '000,000,000.000',","          DollarCred as string,","          FarePerMile as decimal(10,0) '000,000,000.000',","          RPCarrier as string,","          Passengers as decimal(10,0) '000,000,000.000',","          ItinFare as decimal(10,0) '000,000,000.000',","          BulkFare as decimal(10,0) '000,000,000.000',","          Distance as decimal(10,0) '000,000,000.000',","          DistanceGroup as integer,","          MilesFlown as decimal(10,0) '000,000,000.000',","          ItinGeoType as string","     ),","     allowSchemaDrift: true,","     validateSchema: false,","     ignoreNoFilesFound: false) ~> SourceBlobRawDataset","SourceBlobRawDataset sink(allowSchemaDrift: true,","     validateSchema: false,","     input(","          ID as integer,","          ItinID as string,","          Coupons as integer,","          Year as string,","          Quarter as integer,","          Origin as string,","          OriginAirportID as integer,","          OriginAirportSeqID as integer,","          OriginCityMarketID as integer,","          OriginCountry as string,","          OriginStateFips as integer,","          OriginState as string,","          OriginStateName as string,","          OriginWac as integer,","          RoundTrip as decimal(18,2),","          OnLine as decimal(18,2),","          DollarCred as boolean,","          FarePerMile as decimal(18,4),","          RPCarrier as string,","          Passengers as decimal(18,2),","          ItinFare as decimal(18,2),","          BulkFare as decimal(18,2),","          Distance as decimal(18,2),","          DistanceGroup as integer,","          MilesFlown as decimal(18,2),","          ItinGeoType as integer","     ),","     deletable:false,","     insertable:true,","     updateable:false,","     upsertable:false,","     format: 'table',","     skipDuplicateMapInputs: true,","     skipDuplicateMapOutputs: true,","     errorHandlingOption: 'stopOnFirstError',","     mapColumn(","          ItinID,","          Coupons,","          Year,","          Quarter,","          Origin,","          OriginAirportID,","          OriginAirportSeqID,","          OriginCityMarketID,","          OriginCountry,","          OriginStateFips,","          OriginState,","          OriginStateName,","          OriginWac,","          RoundTrip,","          OnLine,","          DollarCred,","          FarePerMile,","          RPCarrier,","          Passengers,","          ItinFare,","          BulkFare,","          Distance,","          DistanceGroup,","          MilesFlown,","          ItinGeoType","     )) ~> SinkTabularDataset"]}},"dependsOn":["[concat(variables('workspaceId'), '/datasets/SourceBlobAirlineTicketDataset')]","[concat(variables('workspaceId'), '/datasets/SinkSqlAirlineTicketDataset')]"]}]}